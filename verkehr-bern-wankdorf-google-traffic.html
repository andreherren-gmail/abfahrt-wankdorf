<!DOCTYPE html>
<html lang="de-CH">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Verkehr – Bern Wankdorf (Google Maps Traffic)</title>
  <style>
    :root{
      --bg:#0b2b6b;
      --fg:#fff;
      --muted:#cdd7ff;
      --accent:#ffd800;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; background:var(--bg); color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
    .app{
      position:fixed; inset:0; display:flex; flex-direction:column;
    }
    header{
      display:flex; justify-content:space-between; align-items:center; gap:1rem;
      padding:.6rem 1rem; background:rgba(255,255,255,.08); color:var(--fg);
      z-index:10; backdrop-filter: blur(4px);
    }
    .title{ display:flex; gap:.7rem; align-items:center; font-weight:700; letter-spacing:.3px;}
    .title .station{ font-weight:800; text-transform:uppercase; }
    .clock{ color:var(--accent); font-weight:700; font-variant-numeric:tabular-nums; }
    #map{ flex:1; min-height:0; }
    .warn{
      position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
      background: rgba(0,0,0,.7); color:#fff; padding:14px 16px; border-radius:10px; z-index:20;
      max-width: min(92vw, 720px); text-align:center; line-height:1.4;
    }
    .hint{ color:var(--muted); font-size:.92rem; }
    .controls{
      position:absolute; right:12px; top:64px; z-index:15; display:flex; flex-direction:column; gap:.5rem;
    }
    .btn{
      background: rgba(0,0,0,.55); color:#fff; border:1px solid rgba(255,255,255,.25);
      padding:.45rem .6rem; border-radius:10px; font-size:.92rem; cursor:pointer; user-select:none;
    }
    .btn:active{ transform: translateY(1px); }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <rect x="1.5" y="5" width="21" height="14" rx="3" ry="3" stroke="white" opacity=".9"></rect>
          <path d="M3.5 12h17" stroke="white" stroke-width="2" opacity=".9"></path>
        </svg>
        <span>Verkehr</span>
        <span class="station">Bern Wankdorf</span>
        <span class="hint">Live (Google Maps Traffic)</span>
      </div>
      <div class="clock"><span id="time">--:--</span> <small id="date" style="color:#cdd7ff;"></small></div>
    </header>
    <div id="map"></div>
    <div class="controls">
      <button class="btn" id="recenterBtn" title="Auf Bern Wankdorf zentrieren">Zentrieren</button>
      <button class="btn" id="toggleTrafficBtn" title="Traffic-Layer an/aus">Traffic an/aus</button>
    </div>
    <div class="warn" id="keyWarn" style="display:none">
      <div style="font-weight:700; margin-bottom:.4rem;">API-Schlüssel erforderlich</div>
      Diese Seite benötigt einen <strong>Google Maps JavaScript API</strong> Schlüssel.<br/>
      Übergib ihn per URL-Parameter z.&nbsp;B.:<br/>
      <code>?key=YOUR_GOOGLE_MAPS_API_KEY</code><br/><br/>
      <span class="hint">Tipp: Hoste die Datei auf GitHub Pages und beschränke den Key auf deine Domain.</span>
    </div>
  </div>

  <script>
    // --- Uhr ---
    const CH_TZ = 'Europe/Zurich';
    function fmtTime(d){ return d.toLocaleTimeString('de-CH',{hour:'2-digit',minute:'2-digit',hour12:false,timeZone:CH_TZ}); }
    function fmtDate(d){ return d.toLocaleDateString('de-CH',{weekday:'short', day:'2-digit', month:'2-digit', year:'numeric', timeZone:CH_TZ}); }
    function tick(){ const n=new Date(); timeEl.textContent=fmtTime(n); dateEl.textContent=fmtDate(n); }
    const timeEl = document.getElementById('time');
    const dateEl = document.getElementById('date');
    tick(); setInterval(tick, 1000);

    // --- QS ---
    function getQS(){ const p=new URLSearchParams(location.search); const o={}; for(const [k,v] of p.entries()) o[k]=v; return o; }
    const qs = getQS();
    const DEFAULT_CENTER = { lat: 46.9596, lng: 7.4669 }; // Bern Wankdorf (ca.)
    const DEFAULT_ZOOM = 14;

    let map, trafficLayer, centerMarker;

    function initMap(){
      const center = (qs.center && qs.center.includes(',')) ?
        { lat: parseFloat(qs.center.split(',')[0]), lng: parseFloat(qs.center.split(',')[1]) } : DEFAULT_CENTER;
      const zoom = qs.zoom ? Math.max(3, Math.min(20, parseInt(qs.zoom,10)||DEFAULT_ZOOM)) : DEFAULT_ZOOM;

      map = new google.maps.Map(document.getElementById('map'), {
        center, zoom,
        mapTypeControl: false,
        streetViewControl: false,
        fullscreenControl: false,
        zoomControl: true,
        styles: [
          { featureType:"poi", stylers:[{visibility:"off"}] },
          { featureType:"transit.station", stylers:[{visibility:"simplified"}] }
        ]
      });

      trafficLayer = new google.maps.TrafficLayer();
      trafficLayer.setMap(map);

      centerMarker = new google.maps.Marker({
        position: center, map, title: "Bern Wankdorf", opacity: 0.0 // invisible marker for recenter animation
      });

      document.getElementById('recenterBtn').addEventListener('click', ()=>{
        map.panTo(center); map.setZoom(zoom);
      });
      document.getElementById('toggleTrafficBtn').addEventListener('click', ()=>{
        trafficLayer.setMap(trafficLayer.getMap() ? null : map);
      });
    }

    (function loadApi(){
      const key = qs.key || "YOUR_GOOGLE_MAPS_API_KEY";
      if(!key || key==="YOUR_GOOGLE_MAPS_API_KEY"){
        document.getElementById('keyWarn').style.display='block';
      }
      const s = document.createElement('script');
      s.src = "https://maps.googleapis.com/maps/api/js?key=" + encodeURIComponent(key) + "&callback=initMap&v=weekly";
      s.async = true; s.defer = true;
      document.head.appendChild(s);
    })();
  </script>
</body>
</html>
